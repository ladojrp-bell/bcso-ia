<h2 class="text-2xl font-semibold mb-4">Edit Case <%= caseData.caseNum %></h2>

<form method="POST" action="/case/<%= caseData.caseNum %>/edit" class="space-y-4">
  <div>
    <label>Status</label>
    <select name="status" class="border p-2 rounded w-full">
      <option value="Open"    <%= caseData.status==='Open'    ? 'selected' : '' %>>Open</option>
      <option value="Closed"  <%= caseData.status==='Closed'  ? 'selected' : '' %>>Closed</option>
      <option value="Pending" <%= caseData.status==='Pending' ? 'selected' : '' %>>Pending</option>
    </select>
  </div>

  <div>
    <label>Assigned To</label>
    <input
      name="assigned"
      value="<%= caseData.assigned || '' %>"
      placeholder="Username or â€”"
      class="border p-2 rounded w-full"
    >
  </div>

  <div>
    <label>Severity</label>
    <select name="severity" class="border p-2 rounded w-full">
      <option value="Low"    <%= caseData.severity==='Low'    ? 'selected' : '' %>>Low</option>
      <option value="Medium" <%= caseData.severity==='Medium' ? 'selected' : '' %>>Medium</option>
      <option value="High"   <%= caseData.severity==='High'   ? 'selected' : '' %>>High</option>
    </select>
  </div>

  <div class="flex items-center">
    <button type="submit" class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600">
      Save Changes
    </button>
    <a href="/case/<%= caseData.caseNum %>" class="ml-4 text-blue-600 underline">
      Cancel
    </a>

    <% if (req.user && req.user.isAdmin) { %>
      <form 
        method="POST" 
        action="/case/<%= caseData.caseNum %>/delete" 
        style="display:inline; margin-left:1rem;" 
        onsubmit="return confirm('Are you sure you want to delete case <%= caseData.caseNum %>?');"
      >
        <button 
          type="submit" 
          class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
        >
          Delete Case
        </button>
      </form>
    <% } %>
  </div>
</form>
And in your index.js, add this route (making sure it comes after your DB setup and ensureAuthenticated middleware):

js
Copy
Edit
// Middleware to ensure only admins can delete:
function ensureAdmin(req, res, next) {
  if (req.user && req.user.isAdmin) {
    return next();
  }
  req.flash('error', 'You do not have permission to do that.');
  res.redirect('/cases');
}

app.post(
  '/case/:caseNum/delete',
  ensureAuthenticated,
  ensureAdmin,
  (req, res) => {
    const caseNum = req.params.caseNum;
    db.run(
      'DELETE FROM cases WHERE caseNum = ?',
      [caseNum],
      function(err) {
        if (err) {
          console.error('Error deleting case:', err);
          req.flash('error', 'Failed to delete case.');
          return res.redirect(`/case/${caseNum}`);
        }
        req.flash('success', `Case ${caseNum} deleted.`);
        res.redirect('/cases');
      }
    );
  }
);
